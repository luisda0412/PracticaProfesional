@model List<Web.ViewModel.ViewModelDetalleIngreso>

<div class="table-responsive-sm">
    @*Accion, nombre de controlador*@

    <table class="table table-striped">
        @if (Model != null)
        {
            <tr>
                <th>
                    Artículo
                </th>
                <th class="center">
                    Cantidad
                </th>
                <th class="right" style="text-align:right">
                    Precio
                </th>
                <th class="right" style="text-align:right">
                    Total
                </th>
                <th style="text-align:center">
                    Opciones
                </th>
            </tr>

            foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.HiddenFor(modelItem => item.articulo.id)
                        @Html.DisplayFor(modelItem => item.articulo.nombre)
                    </td>
                    <td class="center" style="width:1.2em">
                        @Html.EditorFor(modelItem => item.cantidad, new { htmlAttributes = new { @class = "form-control changeCantidad", data_productoid = item.articulo.id, onchange = "updateCantidadC(this)" } })
                    </td>
                    <td class="right" style="text-align:right">

                        ₡@Html.DisplayFor(modelItem => item.precio)
                    </td>

                    <td class="right" style="text-align:right">
                        ₡@Html.DisplayFor(modelItem => item.SubTotal)
                    </td>

                    <td style="text-align:center">

                        @Html.ActionLink("X", "eliminarProducto", "Cotizacion", new { id = item.idArticulo }, new { @class = "btn btn-primary" })
                    </td>
                </tr>
            }
            <div class="col-md-6">
              <div class="form-group3">
               <h5>Desea que la cotización sea enviada por correo?</h5>
               @{
               //Determina si el checkbox debe estar marcado
               bool isChecked = ViewBag.Facturar ?? false;
              }
              @Html.CheckBox("Facturar", isChecked, new { @id = "facturarCheckBox", @class = "control-label col-md-2", @data_toggle = "modal", @data_target = "#exampleModal" })

              </div>
            </div>
        }
    </table>
</div>
@if (Model != null)
{

    <div class="row">
        <div class="col-lg-5 col-sm-5"></div>
        <div class="col-lg-7 col-sm-5 ml-auto">
            <table class="table table-clear">
                <tbody>
                    <tr>
                        <td class="left">
                            <strong>Subtotal</strong>
                        </td>
                        <td class="right" style="width:49%">
                            <strong>₡ @((Web.ViewModel.Cotizacion.Instancia.tirarSubtotal()))</strong>
                        </td>
                    </tr>

                    <tr>
                        <td class="left">
                            <strong>Impuesto de Ventas</strong>
                        </td>
                        <td class="right" style="width:49%">
                            <strong>+ ₡ @((Web.ViewModel.Cotizacion.Instancia.tirarImpuesto()))</strong>
                        </td>
                    </tr>

                    <tr>
                        <td class="left">
                            <strong>Total</strong>
                        </td>
                        <td class="right" style="width:49%">
                            <strong>₡ @((Web.ViewModel.Cotizacion.Instancia.tirarTotal()))</strong>
                        </td>

                    </tr>

                </tbody>
            </table>
            
        </div>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 style="color:black;" class="modal-title fs-5" id="exampleModalLabel">Solicite los datos para la factura electrónica</h1>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                @using (Html.BeginForm("EnviarCorreo", "Cotizacion"))
                {
                    <form>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="message-text" class="col-form-label">Email:</label>
                                <input name="emailCotizar" class="form-control" id="message-text" style="max-width:100%">
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button style="background-color:#09f238; color:white" type="submit" class="btn">Aceptar</button>
                        </div>
                    </form>
                }

            </div>
        </div>
    </div>
}

<script>
    //Desmarcar el checkbox cuando en el modal le den click en cancelar
    $("button").click(function () {
        // Desmarcar todas las checkboxes
        $("input[type=checkbox]").prop("checked", false);
    })
</script>